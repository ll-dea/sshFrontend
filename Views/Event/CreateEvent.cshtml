@* @model SSH_FrontEnd.VM.EventVM.EventCreateVM *@

@* @{ *@
@*     ViewData["Title"] = "Create Event"; *@
@* } *@

@* <h2>Create Event</h2> *@

@* <!-- Step 1: Basic Event Info --> *@
@* <div id="event-step-1"> *@
@*     <div class="form-group"> *@
@*         <label asp-for="Event.EventName">Event Name</label> *@
@*         <input asp-for="Event.EventName" class="form-control" /> *@
@*     </div> *@
@*     <div class="form-group"> *@
@*         <label asp-for="Event.EventDate">Event Date</label> *@
@*         <input asp-for="Event.EventDate" type="date" class="form-control" /> *@
@*     </div> *@
@*     <div class="form-group"> *@
@*         <label asp-for="Event.EventType">Event Type</label> *@
@*         <input asp-for="Event.EventType" class="form-control" /> *@
@*     </div> *@
@*     <button type="button" id="btnDone" class="btn btn-primary mt-2">Done</button> *@
@* </div> *@

@* <!-- Step 2: Provider Buttons --> *@
@* <div id="provider-buttons" class="mt-3" style="display:none;"> *@
@*     <button class="btn btn-outline-dark" onclick="loadPartial('Pastry')">Pastry Shops</button> *@
@*     <button class="btn btn-outline-dark" onclick="loadPartial('Music')">Music Providers</button> *@
@*     <button class="btn btn-outline-dark" onclick="loadPartial('Venue')">Venue Providers</button> *@
@*     <button class="btn btn-outline-dark" onclick="loadPartial('Florist')">Florists</button> *@
@*     <button class="btn btn-outline-dark" onclick="loadPartial('Menu')">Menus</button> *@
@* </div> *@

@* <!-- Step 3–5: Dynamic Section Display --> *@
@* <div id="partial-section" class="mt-4"></div> *@
@* <div id="booked-summary" style="display:none; margin-top: 20px;"> *@
@*     <h4>Booked Items</h4> *@
@*     <ul id="booked-list" class="list-group"></ul> *@
@* </div> *@


@* <!-- Step 6: Submit Form --> *@
@* <form asp-action="CreateFinal" method="post"> *@
@*     @* Hidden inputs for Event *@ 
@*     <input type="hidden" asp-for="Event.EventName" /> *@
@*     <input type="hidden" asp-for="Event.EventDate" /> *@
@*     <input type="hidden" asp-for="Event.EventType" /> *@

@*     @* Hidden fields for booked item IDs *@ 
@*     @foreach (var id in Model.BookedPastryIds) *@
@*     { *@
@*         <input type="hidden" name="BookedPastryIds" value="@id" /> *@
@*     } *@
@*     @foreach (var id in Model.BookedMenuIds) *@
@*     { *@
@*         <input type="hidden" name="BookedMenuIds" value="@id" /> *@
@*     } *@
@*     @foreach (var id in Model.BookedVenueIds) *@
@*     { *@
@*         <input type="hidden" name="BookedVenueIds" value="@id" /> *@
@*     } *@
@*     @foreach (var id in Model.BookedFloristIds) *@
@*     { *@
@*         <input type="hidden" name="BookedFloristIds" value="@id" /> *@
@*     } *@
@*     @foreach (var id in Model.BookedMusicIds) *@
@*     { *@
@*         <input type="hidden" name="BookedMusicIds" value="@id" /> *@
@*     } *@

@*     <button type="submit" class="btn btn-success mt-3">Finish</button> *@
@* </form> *@

@* @section Scripts { *@
@*     <script> *@
@*         window.onload = function () { *@
@*             document.getElementById("btnDone").addEventListener("click", function () { *@
@*                 const name = document.getElementById("Event_EventName").value; *@
@*                 const date = document.getElementById("Event_EventDate").value; *@
@*                 const type = document.getElementById("Event_EventType").value; *@

@*                 if (name && date && type) { *@
@*                     document.getElementById("provider-buttons").style.display = "block"; *@
@*                     document.getElementById("booked-summary").style.display = "block"; *@
@*                 } else { *@
@*                     alert("Please fill all event fields before proceeding."); *@
@*                 } *@
@*             }); *@
@*         }; *@

@*         function loadPartial(type) { *@
@*             fetch(`/Event/Get${type}DetailsList`) *@
@*                 .then(response => { *@
@*                     if (!response.ok) { *@
@*                         throw new Error("Failed to load partial view."); *@
@*                     } *@
@*                     return response.text(); *@
@*                 }) *@
@*                 .then(html => { *@
@*                     document.getElementById("partial-section").innerHTML = html; *@
@*                 }) *@
@*                 .catch(err => { *@
@*                     alert("Error: " + err.message); *@
@*                 }); *@
@*         } *@

@*         const bookedItems = { *@
@*             Pastry: new Set(), *@
@*             Menu: new Set(), *@
@*             Venue: new Set(), *@
@*             Florist: new Set(), *@
@*             Music: new Set() *@
@*         }; *@

@*         function bookItem(type, id) { *@
@*             if (bookedItems[type].has(id)) { *@
@*                 alert(`${type} with ID ${id} is already booked.`); *@
@*                 return; *@
@*             } *@
@*             bookedItems[type].add(id); *@

@*             // Add hidden input to form *@
@*             const form = document.forms[0]; *@
@*             const input = document.createElement("input"); *@
@*             input.type = "hidden"; *@
@*             input.name = `Booked${type}Ids`; *@
@*             input.value = id; *@
@*             input.dataset.bookedId = `${type}-${id}`;  // for easier removal if needed *@
@*             form.appendChild(input); *@

@*             // Update booked summary UI *@
@*             const summary = document.getElementById("booked-list"); *@
@*             const itemElem = document.createElement("li"); *@
@*             itemElem.id = `booked-${type}-${id}`; *@
@*             itemElem.textContent = `${type} ID: ${id} `; *@

@*             // Add remove button *@
@*             const removeBtn = document.createElement("button"); *@
@*             removeBtn.type = "button"; *@
@*             removeBtn.textContent = "Remove"; *@
@*             removeBtn.classList.add("btn", "btn-sm", "btn-danger", "ms-2"); *@
@*             removeBtn.onclick = function() { *@
@*                 // Remove from bookedItems set *@
@*                 bookedItems[type].delete(id); *@
@*                 // Remove hidden input *@
@*                 const hiddenInput = form.querySelector(`input[data-booked-id='${type}-${id}']`); *@
@*                 if(hiddenInput) hiddenInput.remove(); *@
@*                 // Remove from summary UI *@
@*                 itemElem.remove(); *@
@*             }; *@

@*             itemElem.appendChild(removeBtn); *@
@*             summary.appendChild(itemElem); *@

@*             alert(`${type} with ID ${id} booked!`); *@
@*         } *@
@*     </script> *@
@* } *@


@model SSH_FrontEnd.VM.EventVM.EventCreateVM

@{
    ViewData["Title"] = "Create Event";
}

<h2>Create Event</h2>

<!-- Step 1: Basic Event Info -->
<div id="event-step-1">
    <div class="form-group">
        <label asp-for="Event.EventName">Event Name</label>
        <input asp-for="Event.EventName" class="form-control" />
    </div>
    <div class="form-group">
        <label asp-for="Event.EventDate">Event Date</label>
        <input asp-for="Event.EventDate" type="date" class="form-control" />
    </div>
    <div class="form-group">
        <label asp-for="Event.EventType">Event Type</label>
        <input asp-for="Event.EventType" class="form-control" />
    </div>
    <button type="button" id="btnDone" class="btn btn-primary mt-2">Done</button>
</div>

<!-- Step 2: Provider Buttons -->
<div id="provider-buttons" class="mt-3" style="display:none;">
    <button class="btn btn-outline-dark" onclick="loadPartial('Pastry')">Pastry Shops</button>
    <button class="btn btn-outline-dark" onclick="loadPartial('Music')">Music Providers</button>
    <button class="btn btn-outline-dark" onclick="loadPartial('Venue')">Venue Providers</button>
    <button class="btn btn-outline-dark" onclick="loadPartial('Florist')">Florists</button>
    <button class="btn btn-outline-dark" onclick="loadPartial('Menu')">Menus</button>
</div>

<!-- Step 3–5: Dynamic Section Display -->
<div id="partial-section" class="mt-4"></div>

<!-- Booked Items Summary -->
<div id="booked-summary" style="display:none; margin-top: 20px;">
    <h4>Booked Items</h4>
    <ul id="booked-list" class="list-group"></ul>
</div>

<!-- Step 6: Submit Form -->
<form asp-action="CreateFinal" method="post">
    @* Hidden inputs for Event *@
    <input type="hidden" asp-for="Event.EventName" />
    <input type="hidden" asp-for="Event.EventDate" />
    <input type="hidden" asp-for="Event.EventType" />

    @* Hidden fields for booked item IDs from server-side model, if any *@
    @foreach (var id in Model.BookedPastryIds)
    {
        <input type="hidden" name="BookedPastryIds" value="@id" />
    }
    @foreach (var id in Model.BookedMenuIds)
    {
        <input type="hidden" name="BookedMenuIds" value="@id" />
    }
    @foreach (var id in Model.BookedVenueIds)
    {
        <input type="hidden" name="BookedVenueIds" value="@id" />
    }
    @foreach (var id in Model.BookedFloristIds)
    {
        <input type="hidden" name="BookedFloristIds" value="@id" />
    }
    @foreach (var id in Model.BookedMusicIds)
    {
        <input type="hidden" name="BookedMusicIds" value="@id" />
    }

    <button type="submit" class="btn btn-success mt-3">Finish</button>
</form>

@section Scripts {
    <script>
        window.onload = function () {
            document.getElementById("btnDone").addEventListener("click", function () {
                const name = document.getElementById("Event_EventName").value;
                const date = document.getElementById("Event_EventDate").value;
                const type = document.getElementById("Event_EventType").value;

                if (name && date && type) {
                    document.getElementById("provider-buttons").style.display = "block";
                    document.getElementById("booked-summary").style.display = "block";
                } else {
                    alert("Please fill all event fields before proceeding.");
                }
            });
        };

        function loadPartial(type) {
            fetch(`/Event/Get${type}DetailsList`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Failed to load partial view.");
                    }
                    return response.text();
                })
                .then(html => {
                    document.getElementById("partial-section").innerHTML = html;
                })
                .catch(err => {
                    alert("Error: " + err.message);
                });
        }

        const bookedItems = {
            Pastry: new Set(),
            Menu: new Set(),
            Venue: new Set(),
            Florist: new Set(),
            Music: new Set()
        };

        function bookItem(type, id) {
            if (bookedItems[type].has(id)) {
                alert(`${type} with ID ${id} is already booked.`);
                return;
            }
            bookedItems[type].add(id);

            // Add hidden input to form
            const form = document.forms[0];
            const input = document.createElement("input");
            input.type = "hidden";
            input.name = `Booked${type}Ids`;
            input.value = id;
            input.dataset.bookedId = `${type}-${id}`;  // for easier removal if needed
            form.appendChild(input);

            // Update booked summary UI
            const summary = document.getElementById("booked-list");
            const itemElem = document.createElement("li");
            itemElem.id = `booked-${type}-${id}`;
            itemElem.textContent = `${type} ID: ${id} `;

            // Add remove button
            const removeBtn = document.createElement("button");
            removeBtn.type = "button";
            removeBtn.textContent = "Remove";
            removeBtn.classList.add("btn", "btn-sm", "btn-danger", "ms-2");
            removeBtn.onclick = function() {
                // Remove from bookedItems set
                bookedItems[type].delete(id);
                // Remove hidden input
                const hiddenInput = form.querySelector(`input[data-booked-id='${type}-${id}']`);
                if(hiddenInput) hiddenInput.remove();
                // Remove from summary UI
                itemElem.remove();
            };

            itemElem.appendChild(removeBtn);
            summary.appendChild(itemElem);

            alert(`${type} with ID ${id} booked!`);
        }
    </script>
}


